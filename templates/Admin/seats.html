<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8"/>
    <title>Manage Seats</title>
</head>
<body>
<div layout:fragment="content">
    <h1 class="mb-2">Manage Seats</h1>
    <p class="text-muted mb-3">View and manage seats for your buses.</p>
    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addSeatModal">
        <i class="fas fa-plus me-2"></i>Add Seat
    </button>
    <div class="d-flex gap-3 mb-3">
        <div class="input-group w-25">
            <select class="form-control" id="filterBusId" aria-label="Filter by bus">
                <option value="">All Buses</option>
                <option th:each="bus : ${buses}" th:value="${bus.id}" th:text="${bus.busNumber}"></option>
            </select>
        </div>
        <button class="btn btn-outline-secondary" onclick="fetchSeatsByBusId()">
            <i class="fas fa-search me-1"></i>Filter
        </button>
    </div>
    <div id="loadingSpinner" class="spinner-border text-primary d-none" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <div id="errorMessage" class="alert alert-danger d-none mt-3" role="alert"></div>
    <div class="row g-3" id="seatContainer" th:each="seat : ${seats}">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Seat #<span th:text="${seat.id}"></span></h5>
                    <p><strong>Bus ID:</strong> <span th:text="${seat.busId}"></span></p>
                    <p><strong>Number:</strong> <span th:text="${seat.seatNumber}"></span></p>
                    <p><strong>Type:</strong> <span th:text="${seat.type}"></span></p>
                    <p><strong>Available:</strong> <span th:text="${seat.available} ? 'Yes' : 'No'"></span></p>
                    <button class="btn btn-warning btn-sm me-2" th:onclick="'openUpdateSeatModal(\'' + ${seat.id} + '\')'">Edit</button>
                    <button class="btn btn-danger btn-sm" th:onclick="'deleteSeat(\'' + ${seat.id} + '\')'">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Seat Modal -->
    <div class="modal fade" id="addSeatModal" tabindex="-1" aria-labelledby="addSeatModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSeatModalLabel">Add Seat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addSeatForm" th:action="@{/seats/add}" method="post">
                        <div class="mb-3">
                            <label for="seatBusId" class="form-label">Bus</label>
                            <select class="form-control" id="seatBusId" name="busId" required aria-describedby="seatBusIdFeedback">
                                <option value="">Select a bus</option>
                                <option th:each="bus : ${buses}" th:value="${bus.id}" th:text="${bus.busNumber}"></option>
                            </select>
                            <div id="seatBusIdFeedback" class="invalid-feedback">Please select a bus.</div>
                        </div>
                        <div class="mb-3">
                            <label for="seatNumber" class="form-label">Seat Number</label>
                            <input type="text" class="form-control" id="seatNumber" name="seatNumber" required aria-describedby="seatNumberFeedback"/>
                            <div id="seatNumberFeedback" class="invalid-feedback">Seat number is required.</div>
                        </div>
                        <div class="mb-3">
                            <label for="seatType" class="form-label">Seat Type</label>
                            <select class="form-control" id="seatType" name="type" required aria-describedby="seatTypeFeedback">
                                <option value="Standard">Standard</option>
                                <option value="Premium">Premium</option>
                                <option value="Recliner">Recliner</option>
                            </select>
                            <div id="seatTypeFeedback" class="invalid-feedback">Please select a seat type.</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Add Seat</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Seat Modal -->
    <div class="modal fade" id="updateSeatModal" tabindex="-1" aria-labelledby="updateSeatModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateSeatModalLabel">Update Seat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateSeatForm" th:action="@{/seats/update}" method="post">
                        <input type="hidden" id="updateSeatId" name="id"/>
                        <div class="mb-3">
                            <label for="updateSeatBusId" class="form-label">Bus</label>
                            <select class="form-control" id="updateSeatBusId" name="busId" required aria-describedby="updateSeatBusIdFeedback">
                                <option value="">Select a bus</option>
                                <option th:each="bus : ${buses}" th:value="${bus.id}" th:text="${bus.busNumber}"></option>
                            </select>
                            <div id="updateSeatBusIdFeedback" class="invalid-feedback">Please select a bus.</div>
                        </div>
                        <div class="mb-3">
                            <label for="updateSeatNumber" class="form-label">Seat Number</label>
                            <input type="text" class="form-control" id="updateSeatNumber" name="seatNumber" required aria-describedby="updateSeatNumberFeedback"/>
                            <div id="updateSeatNumberFeedback" class="invalid-feedback">Seat number is required.</div>
                        </div>
                        <div class="mb-3">
                            <label for="updateSeatType" class="form-label">Seat Type</label>
                            <select class="form-control" id="updateSeatType" name="type" required aria-describedby="updateSeatTypeFeedback">
                                <option value="Standard">Standard</option>
                                <option value="Premium">Premium</option>
                                <option value="Recliner">Recliner</option>
                            </select>
                            <div id="updateSeatTypeFeedback" class="invalid-feedback">Please select a seat type.</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Update Seat</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div layout:fragment="scripts">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchSeatsByBusId();
            document.getElementById('addSeatForm').addEventListener('submit', addSeat);
            document.getElementById('updateSeatForm').addEventListener('submit', updateSeat);
        });
    </script>
</div>
</body>
</html>