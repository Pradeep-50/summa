<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <meta charset="UTF-8"/>
    <title>Manage Bookings</title>
</head>
<body>
<div layout:fragment="content">
    <h1 class="mb-2">Manage Bookings</h1>
    <p class="text-muted mb-3">View and manage customer bookings.</p>
    <div class="d-flex gap-3 mb-3">
        <div class="input-group w-25">
            <select class="form-control" id="filterBusId" aria-label="Filter by bus">
                <option value="">All Buses</option>
                <option th:each="bus : ${buses}" th:value="${bus.id}" th:text="${bus.busNumber}"></option>
            </select>
        </div>
        <button class="btn btn-outline-secondary" onclick="fetchBookingsByBusId()">
            <i class="fas fa-search me-1"></i>Filter
        </button>
    </div>
    <div id="loadingSpinner" class="spinner-border text-primary d-none" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <div id="errorMessage" class="alert alert-danger d-none mt-3" role="alert"></div>
    <div class="row g-3" id="bookingContainer" th:each="booking : ${bookings}">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Booking #<span th:text="${booking.id}"></span></h5>
                    <p><strong>Bus ID:</strong> <span th:text="${booking.busId}"></span></p>
                    <p><strong>Customer:</strong> <span th:text="${booking.customerName}"></span></p>
                    <p><strong>Seat:</strong> <span th:text="${booking.seatNumber}"></span></p>
                    <p><strong>Status:</strong> <span th:text="${booking.status}"></span></p>
                    <button class="btn btn-danger btn-sm" th:onclick="'cancelBooking(\'' + ${booking.id} + '\')'"
                            th:disabled="${booking.status == 'CANCELLED'}">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div layout:fragment="scripts">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchBookingsByBusId();
        });
    </script>
</div>
</body>
</html>